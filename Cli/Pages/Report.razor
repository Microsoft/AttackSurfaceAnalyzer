@page "/report"

<h4>Report</h4>

@if (Runs.Count > 0)
{
    <div class="runid-box">
        <label for="RunId">Run ID:</label>
        <select id="RunId" @bind="RunIdInput">
            @for (int i = 0; i < Runs.Count; i++)
            {
                <option value="@i">@Runs[i]</option>
            }
        </select>
    </div>
    <Results FirstRunId="@Runs[RunIdInput].firstRunId" SecondRunId="@Runs[RunIdInput].secondRunId" AnalysesHash="@Runs[RunIdInput].analysesHash" MonitorRunId="@Runs[RunIdInput].secondRunId" />
}
else
{
    <p>No results available.</p>
    <p>Please run comparisons before viewing results.</p>
}

@code {

    List<(string firstRunId, string secondRunId, string analysesHash, RUN_STATUS runStatus)> Runs = AttackSurfaceAnalyzerClient.DatabaseManager.GetCompareRuns();

    private int _runIdInput;

    int RunIdInput
    {
        get
        {
            return _runIdInput;
        }
        set
        {
            appData.ExportCollectCommandOptions.FirstRunId = Runs[value].firstRunId;
            appData.ExportCollectCommandOptions.SecondRunId = Runs[value].secondRunId;
            _runIdInput = value;
            this.StateHasChanged();
        }
    }

    System.Threading.Timer timer;

    protected override void OnInitialized()
    {
        timer = new System.Threading.Timer((_) => InvokeAsync(() => StateHasChanged()), null, 0, 100);
        base.OnInitialized();
    }
}
